<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>EBAUI - API documentation : Source: Captcha.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link href="styles/bootstrap.css" rel="stylesheet">
    <link href="styles/docs.css" rel="stylesheet">
    <link href="styles/bootstrap-custom.css" rel="stylesheet">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
  </head>
  <body>
    <header class="header navbar navbar-inverse">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="#"><strong>EBAUI</strong> API documentation</a>
        </div>
      </div>
    </header>

    <div class="container-fluid">
      <div class="row-fluid">
          <div class="span4">
              <h2><a href="index.html">Index</a></h2><div class="well well-small"><ul class="nav nav-list"><li class="nav-header">Namespaces</li><li><a href="ebaui.html"><i class="icon-code"></i> ebaui</a></li><li><a href="ebaui.web.html"><i class="icon-code"></i> web</a></li></ul></div><div class="well well-small"><ul class="nav nav-list"><li class="nav-header">Classes</li><li><a href="ebaui.web.Button.html"><i class="icon-shield" style="color: #0186d1"></i> Button</a></li><li><a href="ebaui.web.ButtonEdit.html"><i class="icon-shield" style="color: #0186d1"></i> ButtonEdit</a></li><li><a href="ebaui.web.Calendar.html"><i class="icon-shield" style="color: #0186d1"></i> Calendar</a></li><li><a href="ebaui.web.Captcha.html"><i class="icon-shield" style="color: #0186d1"></i> Captcha</a></li><li><a href="ebaui.web.CheckBox.html"><i class="icon-shield" style="color: #0186d1"></i> CheckBox</a></li><li><a href="ebaui.web.CheckBoxList.html"><i class="icon-shield" style="color: #0186d1"></i> CheckBoxList</a></li><li><a href="ebaui.web.Combo.html"><i class="icon-shield" style="color: #0186d1"></i> Combo</a></li><li><a href="ebaui.web.ComboBox.html"><i class="icon-shield" style="color: #0186d1"></i> ComboBox</a></li><li><a href="ebaui.web.ComboList.html"><i class="icon-shield" style="color: #0186d1"></i> ComboList</a></li><li><a href="ebaui.web.Control.html"><i class="icon-shield" style="color: #0186d1"></i> Control</a></li><li><a href="ebaui.web.DataGrid.html"><i class="icon-shield" style="color: #0186d1"></i> DataGrid</a></li><li><a href="ebaui.web.DateTimePicker.html"><i class="icon-shield" style="color: #0186d1"></i> DateTimePicker</a></li><li><a href="ebaui.web.Dialog.html"><i class="icon-shield" style="color: #0186d1"></i> Dialog</a></li><li><a href="ebaui.web.DigitValidator.html"><i class="icon-shield" style="color: #0186d1"></i> DigitValidator</a></li><li><a href="ebaui.web.EmailValidator.html"><i class="icon-shield" style="color: #0186d1"></i> EmailValidator</a></li><li><a href="ebaui.web.FileUploader.html"><i class="icon-shield" style="color: #0186d1"></i> FileUploader</a></li><li><a href="ebaui.web.Form.html"><i class="icon-shield" style="color: #0186d1"></i> Form</a></li><li><a href="ebaui.web.FormField.html"><i class="icon-shield" style="color: #0186d1"></i> FormField</a></li><li><a href="ebaui.web.Hidden.html"><i class="icon-shield" style="color: #0186d1"></i> Hidden</a></li><li><a href="ebaui.web.IdentityValidator.html"><i class="icon-shield" style="color: #0186d1"></i> IdentityValidator</a></li><li><a href="ebaui.web.Label.html"><i class="icon-shield" style="color: #0186d1"></i> Label</a></li><li><a href="ebaui.web.LengthValidator.html"><i class="icon-shield" style="color: #0186d1"></i> LengthValidator</a></li><li><a href="ebaui.web.ListBox.html"><i class="icon-shield" style="color: #0186d1"></i> ListBox</a></li><li><a href="ebaui.web.MobileValidator.html"><i class="icon-shield" style="color: #0186d1"></i> MobileValidator</a></li><li><a href="ebaui.web.OnlyCnValidator.html"><i class="icon-shield" style="color: #0186d1"></i> OnlyCnValidator</a></li><li><a href="ebaui.web.Panel.html"><i class="icon-shield" style="color: #0186d1"></i> Panel</a></li><li><a href="ebaui.web.Password.html"><i class="icon-shield" style="color: #0186d1"></i> Password</a></li><li><a href="ebaui.web.RadioList.html"><i class="icon-shield" style="color: #0186d1"></i> RadioList</a></li><li><a href="ebaui.web.RangeValidator.html"><i class="icon-shield" style="color: #0186d1"></i> RangeValidator</a></li><li><a href="ebaui.web.RemoteValidator.html"><i class="icon-shield" style="color: #0186d1"></i> RemoteValidator</a></li><li><a href="ebaui.web.RequiredValidator.html"><i class="icon-shield" style="color: #0186d1"></i> RequiredValidator</a></li><li><a href="ebaui.web.Spinner.html"><i class="icon-shield" style="color: #0186d1"></i> Spinner</a></li><li><a href="ebaui.web.Tab.html"><i class="icon-shield" style="color: #0186d1"></i> Tab</a></li><li><a href="ebaui.web.Tabs.html"><i class="icon-shield" style="color: #0186d1"></i> Tabs</a></li><li><a href="ebaui.web.TelephoneValidator.html"><i class="icon-shield" style="color: #0186d1"></i> TelephoneValidator</a></li><li><a href="ebaui.web.TextArea.html"><i class="icon-shield" style="color: #0186d1"></i> TextArea</a></li><li><a href="ebaui.web.TextBox.html"><i class="icon-shield" style="color: #0186d1"></i> TextBox</a></li><li><a href="ebaui.web.TimeSpinner.html"><i class="icon-shield" style="color: #0186d1"></i> TimeSpinner</a></li><li><a href="ebaui.web.TreeView.html"><i class="icon-shield" style="color: #0186d1"></i> TreeView</a></li><li><a href="ebaui.web.UiLayout.html"><i class="icon-shield" style="color: #0186d1"></i> UiLayout</a></li><li><a href="ebaui.web.UrlValidator.html"><i class="icon-shield" style="color: #0186d1"></i> UrlValidator</a></li><li><a href="ebaui.web.Validator.html"><i class="icon-shield" style="color: #0186d1"></i> Validator</a></li><li><a href="ebaui.web.ZipValidator.html"><i class="icon-shield" style="color: #0186d1"></i> ZipValidator</a></li></ul></div><div class="well well-small"><ul class="nav nav-list"><li class="nav-header">Public Events</li><li><a href="ebaui.web.Dialog.html#event:apply"><i class="icon-bell-alt" style="color: yellow"></i> apply <span class="label label-inverse pull-right">ebaui.web.Dialog</span></a></li><li><a href="ebaui.web.Dialog.html#event:cancel"><i class="icon-bell-alt" style="color: yellow"></i> cancel <span class="label label-inverse pull-right">ebaui.web.Dialog</span></a></li></ul></div><div class="well well-small"><ul class="nav nav-list"><li class="nav-header">Private Events</li></ul></div><div class="well well-small"><ul class="nav nav-list"><li class="nav-header">Global</li><li><a href="global.html#contentWindow"><i class="icon-globe" style="color: black;"></i> contentWindow</a></li><li><a href="global.html#items"><i class="icon-globe" style="color: black;"></i> items</a></li><li><a href="global.html#keyboard"><i class="icon-globe" style="color: black;"></i> keyboard</a></li><li><a href="global.html#val"><i class="icon-globe" style="color: black;"></i> val</a></li></ul></div>
          </div>

          <div class="span8">
              <h1 class="page-header">Source: Captcha.js</h1>
              


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
*   @class      Captcha
*   @classdesc
*   @memberof   ebaui.web
*   @extends    ebaui.web.TextBox
*   @author     monkey      &lt;knightuniverse@qq.com>
*   @param      {Object}    element     -   dom对象
*   @param      {Object}    options     -   控件配置参数
*   @example
*       //  初始化方式一
*       var ns = ebaui.web;
*       var btn = new ns.Captcha( $( '' ),{ title:'',id:'',name:'' } );
*       //  初始化方式二
*       $( '' ).captcha( { title:'',id:'',name:'' } )
*       //  初始化方式三
*       &lt;input id="" title="" name="" data-role="captcha" data-options="{}" /&gt;
*/

var Captcha, _ref,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Captcha = (function(_super) {
  __extends(Captcha, _super);

  function Captcha() {
    _ref = Captcha.__super__.constructor.apply(this, arguments);
    return _ref;
  }

  /**
   *  初始化DOM事件处理程序
   *  @private
   *  @instance
   *  @memberof   ebaui.web.Captcha
   *  @method     _setupEvents
  */


  Captcha.prototype._setupEvents = function(opts) {
    var $root, me;
    Captcha.__super__._setupEvents.call(this, opts);
    me = this;
    $root = me._$root;
    return $root.on('click', '[data-role="btn-reload"]', function(event) {
      return me.refresh();
    });
  };

  /**
   *  数据源格式错误
   *  @private
   *  @instance
   *  @memberof   ebaui.web.Captcha
   *  @member     {String}    _dataSourceInvalidException
  */


  Captcha.prototype._serverDataInvalidException = 'captcha code server response is invalid!!';

  /**
   *  数据源格式错误
   *  @private
   *  @instance
   *  @memberof   ebaui.web.Captcha
   *  @member     {String}    _dataSourceInvalidException
  */


  Captcha.prototype._dataSourceInvalidException = 'the dataSource format is invalid, only remote dataSource supported!';

  /**
   *  加载验证码图片以及图片的字符串
   *  @private
   *  @instance
   *  @memberof   ebaui.web.Captcha
   *  @method     _loadCaptcha
  */


  Captcha.prototype._loadCaptcha = function() {
    var dataSource, isRemote, me, now, postData, rnd, url;
    me = this;
    dataSource = me.dataSource();
    isRemote = me.isUsingRemoteData(dataSource);
    if (!isRemote) {
      throw me._dataSourceInvalidException;
    }
    url = dataSource.url;
    postData = {};
    if (me.isFunc(dataSource.data)) {
      postData = dataSource.data();
    } else {
      $.extend(postData, dataSource.data);
    }
    now = (new Date).getTime();
    rnd = parseInt(Math.random() * 1000);
    postData['t'] = '{0}_{1}'.replace('{0}', now).replace('{1}', rnd);
    url += '?' + $.param(postData);
    return me._$codeImg.attr('src', url);
  };

  /**
   *  初始化控件，声明内部变量
   *  在初始化控件的时候，控件options对象已经初始化完成，html模板也已经转换完成。
   *  @private
   *  @instance
   *  @memberof   ebaui.web.Captcha
   *  @method     _initControl
  */


  Captcha.prototype._init = function(opts) {
    var config, me, _ref1, _ref2, _ref3, _ref4, _ref5, _ref6;
    Captcha.__super__._init.call(this, opts);
    /* 初始化控件自身的一系列属性*/

    me = this;
    config = 'validationUrl';
    me._width = (_ref1 = opts['width']) != null ? _ref1 : 250;
    me._height = (_ref2 = opts['height']) != null ? _ref2 : 21;
    me._validateOnServer = (_ref3 = opts['validateOnServer']) != null ? _ref3 : true;
    /* 
    *   init validation url, by defualts, it is the same with dataSource
    */

    me._validationUrl = (_ref4 = opts[config]) != null ? _ref4 : '';
    me._queryKey = (_ref5 = opts['queryKey']) != null ? _ref5 : 'verify';
    me._dataSource = (_ref6 = opts['dataSource']) != null ? _ref6 : '';
    /* 
    *   dom
    */

    me._$codeImg = $('.eba-code-img', me._$root);
    me._$btnReload = me._$codeImg.parent();
    /*
     *  if validateOnServer and you did not config remote validation rule 
     *  then add remote validation rule automatically
    */

    me._configRemoteValidator(me._validateOnServer);
    /* load captcha code image from remote server*/

    return me._loadCaptcha();
  };

  /**
   *  刷新验证码
   *  @public
   *  @instance
   *  @memberof   ebaui.web.Captcha
   *  @method     refresh
   *  @example
   *      ctrl.refresh();
  */


  Captcha.prototype.refresh = function() {
    return this._loadCaptcha();
  };

  Captcha.prototype._dataSource = '';

  /**
   *  远程数据源
   *  @public
   *  @instance
   *  @memberof   ebaui.web.Captcha
   *  @member     {Object}                dataSource
   *  @property   {String}                dataSource.url          - 服务端URL
   *  @property   {Object|Function}       dataSource.data         - 向服务器发起AJAX请求的时候，要发送给服务器的URL参数
   *  @example    &lt;caption>get&lt;/caption>
   *      var src = ctrl.dataSource();
   *  @example    &lt;caption>set&lt;/caption>
   *
   *      #  服务端数据
   *      ctrl.dataSource( {
   *          url : 'http:#xx.xx/xx?xx=xx',
   *          data : {}
   *      } );
   *
   *      #  服务端数据
   *      ctrl.dataSource( {
   *          url : 'http:#xx.xx/xx?xx=xx',
   *          data : function(){ 
   *              # your logic
   *              return {};
   *          }
   *      } );
  */


  Captcha.prototype.dataSource = function(val) {
    var me;
    me = this;
    if (val == null) {
      return me._dataSource;
    }
    return me._dataSource = val;
  };

  /**
   *  初始化服务端验证
   *  @public
   *  @instance
   *  @memberof   ebaui.web.Captcha
   *  @method     _configRemoteValidator
  */


  Captcha.prototype._configRemoteValidator = function(validateOnServer) {
    var captchaPass, me, validatorConfig;
    me = this;
    /*
    *   init remote validator
    */

    if (validateOnServer && !me.hasValidator('remote')) {
      captchaPass = function(value, serverData) {
        if (!serverData) {
          return false;
        }
        if (serverData['result'] == null) {
          return false;
        }
        return parseInt(serverData['result']) === 1;
      };
      validatorConfig = {
        url: me.validationUrl(),
        token: me.queryKey(),
        pass: captchaPass
      };
      me._validators.push(new RemoteValidator(validatorConfig));
      return void 0;
    }
    if (!validateOnServer) {
      return me.removeValidator('remote');
    }
  };

  Captcha.prototype._validateOnServer = true;

  /**
   *  开启服务端验证
   *  @public
   *  @instance
   *  @memberof   ebaui.web.Captcha
   *  @member     {Boolean}                validateOnServer
   *  @default    false
   *  @example    &lt;caption>get&lt;/caption>
   *      var src = ctrl.validateOnServer();
   *  @example    &lt;caption>set&lt;/caption>
   *      ctrl.validateOnServer( true );
  */


  Captcha.prototype.validateOnServer = function(val) {
    var me;
    me = this;
    if (!me.isBoolean(val)) {
      return me._validateOnServer;
    }
    me._validateOnServer = val;
    return me._configRemoteValidator(val);
  };

  Captcha.prototype._validationUrl = '';

  /**
   *  验证码的服务端验证地址，默认和dataSource里面配置的url一样
   *  @public
   *  @instance
   *  @memberof   ebaui.web.Captcha
   *  @member     {String}                validationUrl
   *  @example    &lt;caption>get&lt;/caption>
   *      var src = ctrl.validationUrl();
   *  @example    &lt;caption>set&lt;/caption>
   *      ctrl.validationUrl( 'http:#' );
  */


  Captcha.prototype.validationUrl = function(val) {
    var me, re;
    me = this;
    re = /^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;
    if (!re.test(val)) {
      return me._validationUrl;
    }
    return me._validationUrl = val;
  };

  Captcha.prototype._queryKey = 'verify';

  /**
   *  控件进行验证的时候，要提交到验证服务器的url query parameter key
   *  @public
   *  @instance
   *  @default    'verify'
   *  @memberof   ebaui.web.Captcha
   *  @member     {String}                queryKey
   *  @example    &lt;caption>get&lt;/caption>
   *      var src = ctrl.queryKey();
   *  @example    &lt;caption>set&lt;/caption>
   *      ctrl.queryKey( '' );
  */


  Captcha.prototype.queryKey = function(val) {
    var me;
    me = this;
    if (!!me.isEmpty(val)) {
      return me._queryKey;
    }
    return me._queryKey = val;
  };

  return Captcha;

})(TextBox);

ebaui.web.registerFormControl('Captcha', Captcha);
</code></pre>
        </article>
    </section>




          </div>
      </div>

        <br clear="both">

      <footer>
        Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Mon Mar 24 2014 16:22:54 GMT+0800 (CST)
        <br>
      </footer>
      <script> prettyPrint(); </script>
    </div>
  </body>
</html>
